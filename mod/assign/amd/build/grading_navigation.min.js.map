{"version":3,"sources":["../src/grading_navigation.js"],"names":["define","$","notification","str","autocomplete","ajax","checker","GradingNavigation","selector","_regionSelector","_region","_filters","_users","_filteredUsers","_lastXofYUpdate","_firstLoadUsers","_loadAllUsers","find","on","_handlePreviousUser","bind","_handleNextUser","_handleChangeUser","_toggleExpandFilters","document","_refreshSelector","toggleLink","configPanel","getElementById","attr","_filterChanged","userid","data","_selectUserById","get_string","done","s","enhance","fail","exception","_isLoading","prototype","_lastFilters","select","assignmentid","groupid","useridlistid","filterPanel","filter","val","workflowFilter","markerFilter","call","methodname","args","assignid","onlyids","tablesort","_usersLoaded","users","length","trigger","_selectNoUser","_triggerNextUserEvent","_checkClickOutsideConfigureFilters","event","is","target","has","hide","unbind","_updateFilterPreferences","userId","filterList","preferenceNames","preferences","i","deferred","Deferred","resolve","newValue","push","name","value","filters","each","idx","ele","element","prop","filterlist","text","join","currentUserID","sec","Date","now","Math","random","id","toString","replace","padEnd","uniqid","trunc","parseInt","foundIndex","index","user","_refreshCount","checkFormForChanges","get_strings","key","component","strs","confirm","useridnumber","isNaN","preventDefault","closest","expanded","css","stopPropagation","e","currentUserId","currentIndex","count","newIndex","saved","_setCountString","x","y","updateNumber","show","url","URL","window","location","searchParams","get","newid","recordid","set","history","replaceState","nextUserId","nextUser"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to handle changing users via the user selector in the header.\n *\n * @module     mod_assign/grading_navigation\n * @copyright  2016 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.1\n */\ndefine(['jquery', 'core/notification', 'core/str', 'core/form-autocomplete',\n        'core/ajax', 'mod_assign/grading_form_change_checker'],\n       function($, notification, str, autocomplete, ajax, checker) {\n\n    /**\n     * GradingNavigation class.\n     *\n     * @class mod_assign/grading_navigation\n     * @param {String} selector The selector for the page region containing the user navigation.\n     */\n    var GradingNavigation = function(selector) {\n        this._regionSelector = selector;\n        this._region = $(selector);\n        this._filters = [];\n        this._users = [];\n        this._filteredUsers = [];\n        this._lastXofYUpdate = 0;\n        this._firstLoadUsers = true;\n\n        // Get the current user list from a webservice.\n        this._loadAllUsers();\n\n        // We do not allow navigation while ajax requests are pending.\n        // Attach listeners to the select and arrow buttons.\n\n        this._region.find('[data-action=\"previous-user\"]').on('click', this._handlePreviousUser.bind(this));\n        this._region.find('[data-action=\"next-user\"]').on('click', this._handleNextUser.bind(this));\n        this._region.find('[data-action=\"change-user\"]').on('change', this._handleChangeUser.bind(this));\n        this._region.find('[data-region=\"user-filters\"]').on('click', this._toggleExpandFilters.bind(this));\n\n        $(document).on('user-changed', this._refreshSelector.bind(this));\n        $(document).on('done-saving-show-next', this._handleNextUser.bind(this));\n\n        // Position the configure filters panel under the link that expands it.\n        var toggleLink = this._region.find('[data-region=\"user-filters\"]');\n        var configPanel = $(document.getElementById(toggleLink.attr('aria-controls')));\n\n        configPanel.on('change', 'select', this._filterChanged.bind(this));\n\n        var userid = $('[data-region=\"grading-navigation-panel\"]').data('first-userid');\n        if (userid) {\n            this._selectUserById(userid);\n        }\n\n        str.get_string('changeuser', 'mod_assign').done(function(s) {\n                autocomplete.enhance('[data-action=change-user]', false, 'mod_assign/participant_selector', s);\n            }\n        ).fail(notification.exception);\n\n        $(document).bind(\"start-loading-user\", function() {\n            this._isLoading = true;\n        }.bind(this));\n        $(document).bind(\"finish-loading-user\", function() {\n            this._isLoading = false;\n        }.bind(this));\n    };\n\n    /** @property {Boolean} Boolean tracking active ajax requests. */\n    GradingNavigation.prototype._isLoading = false;\n\n    /** @property {String} Selector for the page region containing the user navigation. */\n    GradingNavigation.prototype._regionSelector = null;\n\n    /** @property {Array} The list of active filter keys */\n    GradingNavigation.prototype._filters = null;\n\n    /** @property {Array} The list of users */\n    GradingNavigation.prototype._users = null;\n\n    /** @property {JQuery} JQuery node for the page region containing the user navigation. */\n    GradingNavigation.prototype._region = null;\n\n    /** @property {String} Last active filters */\n    GradingNavigation.prototype._lastFilters = '';\n\n    /**\n     * Load the list of all users for this assignment.\n     *\n     * @private\n     * @method _loadAllUsers\n     * @return {Boolean} True if the user list was fetched.\n     */\n    GradingNavigation.prototype._loadAllUsers = function() {\n        var select = this._region.find('[data-action=change-user]');\n        var assignmentid = select.attr('data-assignmentid');\n        var groupid = select.attr('data-groupid');\n        var useridlistid = $('[data-region=\"grading-navigation-panel\"]').data('userid-list-id');\n\n        var filterPanel = this._region.find('[data-region=\"configure-filters\"]');\n        var filter = filterPanel.find('select[name=\"filter\"]').val();\n        var workflowFilter = filterPanel.find('select[name=\"workflowfilter\"]');\n        if (workflowFilter) {\n            filter += ',' + workflowFilter.val();\n        }\n        var markerFilter = filterPanel.find('select[name=\"markerfilter\"]');\n        if (markerFilter) {\n            filter += ',' + markerFilter.val();\n        }\n\n        if (this._lastFilters == filter) {\n            return false;\n        }\n        this._lastFilters = filter;\n\n        ajax.call([{\n            methodname: 'mod_assign_list_participants',\n            args: {\n                assignid: assignmentid,\n                groupid: groupid,\n                filter: '',\n                onlyids: true,\n                tablesort: true,\n                useridlistid: useridlistid\n            },\n            done: this._usersLoaded.bind(this),\n            fail: notification.exception\n        }]);\n        return true;\n    };\n\n    /**\n     * Call back to rebuild the user selector and x of y info when the user list is updated.\n     *\n     * @private\n     * @method _usersLoaded\n     * @param {Array} users\n     */\n    GradingNavigation.prototype._usersLoaded = function(users) {\n        this._firstLoadUsers = false;\n        this._filteredUsers = this._users = users;\n        if (this._users.length) {\n            // Position the configure filters panel under the link that expands it.\n            var toggleLink = this._region.find('[data-region=\"user-filters\"]');\n            var configPanel = $(document.getElementById(toggleLink.attr('aria-controls')));\n\n            configPanel.find('select[name=\"filter\"]').trigger('change');\n        } else {\n            this._selectNoUser();\n        }\n        this._triggerNextUserEvent();\n    };\n\n    /**\n     * Close the configure filters panel if a click is detected outside of it.\n     *\n     * @private\n     * @method _checkClickOutsideConfigureFilters\n     * @param {Event} event\n     */\n    GradingNavigation.prototype._checkClickOutsideConfigureFilters = function(event) {\n        var configPanel = this._region.find('[data-region=\"configure-filters\"]');\n\n        if (!configPanel.is(event.target) && configPanel.has(event.target).length === 0) {\n            var toggleLink = this._region.find('[data-region=\"user-filters\"]');\n\n            configPanel.hide();\n            configPanel.attr('aria-hidden', 'true');\n            toggleLink.attr('aria-expanded', 'false');\n            $(document).unbind('click.mod_assign_grading_navigation');\n        }\n    };\n\n    /**\n     * Close the configure filters panel if a click is detected outside of it.\n     *\n     * @private\n     * @method _updateFilterPreference\n     * @param {Number} userId The current user id.\n     * @param {Array} filterList The list of current filter values.\n     * @param {Array} preferenceNames The names of the preferences to update\n     * @return {Promise} Resolved when all the preferences are updated.\n     */\n    GradingNavigation.prototype._updateFilterPreferences = function(userId, filterList, preferenceNames) {\n        var preferences = [],\n            i = 0;\n\n        if (filterList.length == 0 || this._firstLoadUsers) {\n            // Nothing to update.\n            var deferred = $.Deferred();\n            deferred.resolve();\n            return deferred;\n        }\n        // General filter.\n        // Set the user preferences to the current filters.\n        for (i = 0; i < filterList.length; i++) {\n            var newValue = filterList[i];\n            if (newValue == 'none') {\n                newValue = '';\n            }\n\n            preferences.push({\n                userid: userId,\n                name: preferenceNames[i],\n                value: newValue\n            });\n        }\n\n        return ajax.call([{\n            methodname: 'core_user_set_user_preferences',\n            args: {\n                preferences: preferences\n            }\n        }])[0];\n    };\n    /**\n     * Turn a filter on or off.\n     *\n     * @private\n     * @method _filterChanged\n     * @param {Event} event\n     */\n    GradingNavigation.prototype._filterChanged = function() {\n        // There are 3 types of filter right now.\n        var filterPanel = this._region.find('[data-region=\"configure-filters\"]');\n        var filters = filterPanel.find('select');\n        var preferenceNames = [];\n\n        this._filters = [];\n        filters.each(function(idx, ele) {\n            var element = $(ele);\n            this._filters.push(element.val());\n            preferenceNames.push('assign_' + element.prop('name'));\n        }.bind(this));\n\n        // Update the active filter string.\n        var filterlist = [];\n        filterPanel.find('option:checked').each(function(idx, ele) {\n            filterlist[filterlist.length] = $(ele).text();\n        });\n        if (filterlist.length) {\n            this._region.find('[data-region=\"user-filters\"] span').text(filterlist.join(', '));\n        } else {\n            str.get_string('nofilters', 'mod_assign').done(function(s) {\n                this._region.find('[data-region=\"user-filters\"] span').text(s);\n            }.bind(this)).fail(notification.exception);\n        }\n\n        var select = this._region.find('[data-action=change-user]');\n        var currentUserID = select.data('currentuserid');\n        this._updateFilterPreferences(currentUserID, this._filters, preferenceNames).done(function() {\n            // Generate a new key for the SESSION cache used by mod_assign_list_participants.\n            // See MDL-69920 for details.\n            var sec = Date.now() * 1000 + Math.random() * 1000;\n            var id = sec.toString(16).replace(/\\./g, \"\").padEnd(14, \"0\");\n            var uniqid = `${id}${`${Math.trunc(Math.random() * 100000000)}`}`;\n            $('[data-region=\"grading-navigation-panel\"]').data('userid-list-id', uniqid);\n\n            // Reload the list of users to apply the new filters.\n            if (!this._loadAllUsers()) {\n                var userid = parseInt(select.attr('data-selected'));\n                var foundIndex = 0;\n                // Search the returned users for the current selection.\n                $.each(this._filteredUsers, function(index, user) {\n                    if (userid == user.id) {\n                        foundIndex = index;\n                    }\n                });\n\n                if (this._filteredUsers.length) {\n                    this._selectUserById(this._filteredUsers[foundIndex].id);\n                } else {\n                    this._selectNoUser();\n                }\n\n            }\n        }.bind(this)).fail(notification.exception);\n        this._refreshCount();\n    };\n\n    /**\n     * Select no users, because no users match the filters.\n     *\n     * @private\n     * @method _selectNoUser\n     */\n    GradingNavigation.prototype._selectNoUser = function() {\n        // Detect unsaved changes, and offer to save them - otherwise change user right now.\n        if (this._isLoading) {\n            return;\n        }\n        if (checker.checkFormForChanges('[data-region=\"grade-panel\"] .gradeform')) {\n            // Form has changes, so we need to confirm before switching users.\n            str.get_strings([\n                {key: 'unsavedchanges', component: 'mod_assign'},\n                {key: 'unsavedchangesquestion', component: 'mod_assign'},\n                {key: 'saveandcontinue', component: 'mod_assign'},\n                {key: 'cancel', component: 'core'},\n            ]).done(function(strs) {\n                notification.confirm(strs[0], strs[1], strs[2], strs[3], function() {\n                    $(document).trigger('save-changes', -1);\n                });\n            });\n        } else {\n            $(document).trigger('user-changed', -1);\n        }\n    };\n\n    /**\n     * Select the specified user by id.\n     *\n     * @private\n     * @method _selectUserById\n     * @param {Number} userid\n     */\n    GradingNavigation.prototype._selectUserById = function(userid) {\n        var select = this._region.find('[data-action=change-user]');\n        var useridnumber = parseInt(userid, 10);\n\n        // Detect unsaved changes, and offer to save them - otherwise change user right now.\n        if (this._isLoading) {\n            return;\n        }\n        if (checker.checkFormForChanges('[data-region=\"grade-panel\"] .gradeform')) {\n            // Form has changes, so we need to confirm before switching users.\n            str.get_strings([\n                {key: 'unsavedchanges', component: 'mod_assign'},\n                {key: 'unsavedchangesquestion', component: 'mod_assign'},\n                {key: 'saveandcontinue', component: 'mod_assign'},\n                {key: 'cancel', component: 'core'},\n            ]).done(function(strs) {\n                notification.confirm(strs[0], strs[1], strs[2], strs[3], function() {\n                    $(document).trigger('save-changes', useridnumber);\n                });\n            });\n        } else {\n            select.attr('data-selected', userid);\n\n            if (!isNaN(useridnumber) && useridnumber > 0) {\n                $(document).trigger('user-changed', userid);\n            }\n        }\n    };\n\n    /**\n     * Expand or collapse the filter config panel.\n     *\n     * @private\n     * @method _toggleExpandFilters\n     * @param {Event} event\n     */\n    GradingNavigation.prototype._toggleExpandFilters = function(event) {\n        event.preventDefault();\n        var toggleLink = $(event.target).closest('[data-region=\"user-filters\"]');\n        var expanded = toggleLink.attr('aria-expanded') == 'true';\n        var configPanel = $(document.getElementById(toggleLink.attr('aria-controls')));\n\n        if (expanded) {\n            configPanel.hide();\n            configPanel.attr('aria-hidden', 'true');\n            toggleLink.attr('aria-expanded', 'false');\n            $(document).unbind('click.mod_assign_grading_navigation');\n        } else {\n            configPanel.css('display', 'inline-block');\n            configPanel.attr('aria-hidden', 'false');\n            toggleLink.attr('aria-expanded', 'true');\n            event.stopPropagation();\n            $(document).on('click.mod_assign_grading_navigation', this._checkClickOutsideConfigureFilters.bind(this));\n        }\n    };\n\n    /**\n     * Change to the previous user in the grading list.\n     *\n     * @private\n     * @method _handlePreviousUser\n     * @param {Event} e\n     */\n    GradingNavigation.prototype._handlePreviousUser = function(e) {\n        e.preventDefault();\n        var select = this._region.find('[data-action=change-user]');\n        var currentUserId = select.attr('data-selected');\n        var i = 0;\n        var currentIndex = 0;\n\n        for (i = 0; i < this._filteredUsers.length; i++) {\n            if (this._filteredUsers[i].id == currentUserId) {\n                currentIndex = i;\n                break;\n            }\n        }\n\n        var count = this._filteredUsers.length;\n        var newIndex = (currentIndex - 1);\n        if (newIndex < 0) {\n            newIndex = count - 1;\n        }\n\n        if (count) {\n            this._selectUserById(this._filteredUsers[newIndex].id);\n        }\n    };\n\n    /**\n     * Change to the next user in the grading list.\n     *\n     * @param {Event} e\n     * @param {Boolean} saved Has the form already been saved? Skips checking for changes if true.\n     */\n    GradingNavigation.prototype._handleNextUser = function(e, saved) {\n        e.preventDefault();\n        var select = this._region.find('[data-action=change-user]');\n        var currentUserId = select.attr('data-selected');\n        var i = 0;\n        var currentIndex = 0;\n\n        for (i = 0; i < this._filteredUsers.length; i++) {\n            if (this._filteredUsers[i].id == currentUserId) {\n                currentIndex = i;\n                break;\n            }\n        }\n\n        var count = this._filteredUsers.length;\n        var newIndex = (currentIndex + 1) % count;\n\n        if (saved && count) {\n            // If we've already saved the grade, skip checking if we've made any changes.\n            var userid = this._filteredUsers[newIndex].id;\n            var useridnumber = parseInt(userid, 10);\n            select.attr('data-selected', userid);\n            if (!isNaN(useridnumber) && useridnumber > 0) {\n                $(document).trigger('user-changed', userid);\n            }\n        } else if (count) {\n            this._selectUserById(this._filteredUsers[newIndex].id);\n        }\n    };\n\n    /**\n     * Set count string. This method only sets the value for the last time it was ever called to deal\n     * with promises that return in a non-predictable order.\n     *\n     * @private\n     * @method _setCountString\n     * @param {Number} x\n     * @param {Number} y\n     */\n    GradingNavigation.prototype._setCountString = function(x, y) {\n        var updateNumber = 0;\n        this._lastXofYUpdate++;\n        updateNumber = this._lastXofYUpdate;\n\n        var param = {x: x, y: y};\n        str.get_string('xofy', 'mod_assign', param).done(function(s) {\n            if (updateNumber == this._lastXofYUpdate) {\n                this._region.find('[data-region=\"user-count-summary\"]').text(s);\n            }\n        }.bind(this)).fail(notification.exception);\n    };\n\n    /**\n     * Rebuild the x of y string.\n     *\n     * @private\n     * @method _refreshCount\n     */\n    GradingNavigation.prototype._refreshCount = function() {\n        var select = this._region.find('[data-action=change-user]');\n        var userid = select.attr('data-selected');\n        var i = 0;\n        var currentIndex = 0;\n\n        if (isNaN(userid) || userid <= 0) {\n            this._region.find('[data-region=\"user-count\"]').hide();\n        } else {\n            this._region.find('[data-region=\"user-count\"]').show();\n\n            for (i = 0; i < this._filteredUsers.length; i++) {\n                if (this._filteredUsers[i].id == userid) {\n                    currentIndex = i;\n                    break;\n                }\n            }\n            var count = this._filteredUsers.length;\n            if (count) {\n                currentIndex += 1;\n            }\n            this._setCountString(currentIndex, count);\n            // Update window URL\n            if (currentIndex > 0) {\n                var url = new URL(window.location);\n                if (parseInt(url.searchParams.get('blindid')) > 0) {\n                    var newid = this._filteredUsers[currentIndex - 1].recordid;\n                    url.searchParams.set('blindid', newid);\n                } else {\n                    url.searchParams.set('userid', userid);\n                }\n                // We do this so a browser refresh will return to the same user.\n                window.history.replaceState({}, \"\", url);\n            }\n        }\n    };\n\n    /**\n     * Respond to a user-changed event by updating the selector.\n     *\n     * @private\n     * @method _refreshSelector\n     * @param {Event} event\n     * @param {String} userid\n     */\n    GradingNavigation.prototype._refreshSelector = function(event, userid) {\n        var select = this._region.find('[data-action=change-user]');\n        userid = parseInt(userid, 10);\n\n        if (!isNaN(userid) && userid > 0) {\n            select.attr('data-selected', userid);\n        }\n        this._refreshCount();\n    };\n\n    /**\n     * Trigger the next user event depending on the number of filtered users\n     *\n     * @private\n     * @method _triggerNextUserEvent\n     */\n    GradingNavigation.prototype._triggerNextUserEvent = function() {\n        if (this._filteredUsers.length > 1) {\n            $(document).trigger('next-user', {nextUserId: null, nextUser: true});\n        } else {\n            $(document).trigger('next-user', {nextUser: false});\n        }\n    };\n\n    /**\n     * Change to a different user in the grading list.\n     *\n     * @private\n     * @method _handleChangeUser\n     * @param {Event} event\n     */\n    GradingNavigation.prototype._handleChangeUser = function() {\n        var select = this._region.find('[data-action=change-user]');\n        var userid = parseInt(select.val(), 10);\n\n        if (this._isLoading) {\n            return;\n        }\n        if (checker.checkFormForChanges('[data-region=\"grade-panel\"] .gradeform')) {\n            // Form has changes, so we need to confirm before switching users.\n            str.get_strings([\n                {key: 'unsavedchanges', component: 'mod_assign'},\n                {key: 'unsavedchangesquestion', component: 'mod_assign'},\n                {key: 'saveandcontinue', component: 'mod_assign'},\n                {key: 'cancel', component: 'core'},\n            ]).done(function(strs) {\n                notification.confirm(strs[0], strs[1], strs[2], strs[3], function() {\n                    $(document).trigger('save-changes', userid);\n                });\n            });\n        } else {\n            if (!isNaN(userid) && userid > 0) {\n                select.attr('data-selected', userid);\n\n                $(document).trigger('user-changed', userid);\n            }\n        }\n    };\n\n    return GradingNavigation;\n});\n"],"file":"grading_navigation.min.js"}